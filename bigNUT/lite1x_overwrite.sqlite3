/*
  If you want to overwrite the NUTsqlite database with the germane data from
  bigNUT, first change the following line to point to your nut.sqlite db:
*/

attach '../nut/nut.sqlite' as lite;

/*
  Now, run this init file like this:  sqlite3 -init lite.sqlite3 nut.db

  If you are already looking at a bigNUT prompt you could also do it this way:
  bigNUT> .read lite.sqlite3
*/

begin;

DELETE
FROM   lite.wlog;INSERT INTO lite.wlog
SELECT weight,
       bodyfat,
       wldate,
       cleardate
FROM   z_wl;DELETE
FROM   lite.mealfoods;INSERT INTO lite.mealfoods
SELECT meal_id / 100,
       meal_id % 100,
       ndb_no,
       gm_wgt / 100.0
FROM   mealfoods;DELETE
FROM   lite.theusual;INSERT INTO lite.theusual
SELECT    meal_name,
          ndb_no,
          CASE
                    WHEN nutr_no IS NULL THEN 'No Auto Portion Control'
                    ELSE nutrdesc
          END
FROM      z_tu
LEFT JOIN nutr_def
using     (nutr_no);UPDATE lite.options
SET    defanal_am =
       (
              SELECT defanal_am
              FROM   options);UPDATE lite.nutr_def
SET    nutopt =
       (
              SELECT nutopt
              FROM   nutr_def
              WHERE  nutrdesc = 'Protein')
WHERE  nutrdesc = 'Protein';UPDATE lite.nutr_def
SET    nutopt =
       (
              SELECT nutopt
              FROM   nutr_def
              WHERE  nutrdesc = 'Total Fat')
WHERE  nutrdesc = 'Total Fat';UPDATE lite.nutr_def
SET    nutopt =
       (
              SELECT nutopt
              FROM   nutr_def
              WHERE  nutrdesc = 'Non-Fiber Carb')
WHERE  nutrdesc = 'Non-Fiber Carb';UPDATE lite.nutr_def
SET    nutopt =
       (
              SELECT nutopt
              FROM   nutr_def
              WHERE  nutrdesc = 'Calories')
WHERE  nutrdesc = 'Calories';COMMIT;
detach lite;
